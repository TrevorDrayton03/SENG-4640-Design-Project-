<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: DataManager.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: DataManager.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { Component } from 'react';
import DataTable from "./DataTable";
import Form from 'react-bootstrap/Form';
import PetModal from "./modals/PetModal";
import SuppliesModal from "./modals/SuppliesModal";

/**
* A component to manage pet and supplies data displayed in a DataTable.
* @component
*/

class DataManager extends Component {
    constructor(props) {
        super(props);
        /**
        * @typedef {Object} DataManagerState
        * @property {string} search - Search string to filter displayed data.
        * @property {Array&lt;Object>} fetchedData - Data fetched from server.
        * @property {boolean} showModal - Controls visibility of modals.
        * @property {string} type - The type of data being displayed (pets or supplies).
        */
        /** @type {DataManagerState} */
        this.state = {
            search: '',
            fetchedData: null,
            showModal: false,
            type: "pets"
        };
        this.handleTypeChange = this.handleTypeChange.bind(this);
        this.handleUpdate = this.handleUpdate.bind(this);
        this.handleDelete = this.handleDelete.bind(this);
        this.handleSave = this.handleSave.bind(this);
        this.handleCloseModal = this.handleCloseModal.bind(this);
        this.handleOpenModal = this.handleOpenModal.bind(this);
        this.handleSearch = this.handleSearch.bind(this);

    }

    /**
     * Sets the showModal state to true.
     */
    handleOpenModal = () => {
        this.setState({ showModal: true });
    }

    /**
     * Sets the showModal state to false.
     */
    handleCloseModal = () => {
        this.setState({ showModal: false });
    }

    /**
     * Sets the search state to the value of the search input element.
     * @param {object} e - The event object.
     */
    handleSearch = (e) => {
        this.setState({ search: e.target.value });
    }

    /**
    * Fetches pet or supplies data based on the Form.Select selection.
    * Called onChange.
    * @param {object} e - The event object.
    */
    handleTypeChange = async (e) => {
        this.setState({ type: e.target.value })
        if (e.target.value === "pets") {
            try {
                const response = await fetch('http://localhost:3000/api/petData');
                const pets = await response.json();
                this.setState({
                    fetchedData: pets
                });
            } catch (error) {
                console.error(error);
            }
        }
        else if (e.target.value === "supplies") {
            try {
                const response = await fetch('http://localhost:3000/api/suppliesData');
                const supplies = await response.json();
                this.setState({
                    fetchedData: supplies
                });
            } catch (error) {
                console.error(error);
            }
        }
    }

    /**
    * Updates the fetchedData state with the updated data.
    * @param {object} updatedData - The data to update.
    */
    handleUpdate = (updatedData) => {
        const keyToUpdate = updatedData._id;
        // fetchedDataCopy is fetchedData but the object with the same key as keyToUpdate is being replaced with updatedData
        const fetchedDataCopy = this.state.fetchedData.map((data) => {
            if (data._id === keyToUpdate) {
                return updatedData;
            }
            return data;
        });
        this.setState({ fetchedData: fetchedDataCopy });
    }

    /**
    * Adds new data to the fetchedData state.
    * @param {object} newData - The new data to add.
    */
    handleSave = (newData) => {
        const updatedData = [...this.state.fetchedData, newData];
        this.setState({ fetchedData: updatedData });
    }

    /**
    * Function that handles the deletion of a pet or a supply from the database
    * @async
    * @function
    * @param {string} key - the unique key that identifies the item to be deleted
    * @returns {void}
    */
    handleDelete = async (key) => {
        const confirmDelete = window.confirm("Are you sure you want to delete this item?");
        if (confirmDelete) {
            if (this.state.type === "pets")
                try {
                    await fetch(`http://localhost:3000/api/deletePet?key=${key}`);
                    // update the state to remove the deleted item
                    // filter creates a shallow copy of the array and filters what does not pass the conditional statement
                    const updatedData = this.state.fetchedData.filter(data => data._id !== key);
                    this.setState({ fetchedData: updatedData });
                } catch (error) {
                    console.error(error);
                }
            else if (this.state.type === "supplies") {
                try {
                    await fetch(`http://localhost:3000/api/deleteSupply?key=${key}`);
                    // update the state to remove the deleted item
                    // filter creates a shallow copy of the array and filters what does not pass the conditional statement
                    const updatedData = this.state.fetchedData.filter(data => data._id !== key);
                    this.setState({ fetchedData: updatedData });
                } catch (error) {
                    console.error(error);
                }
            }
        }
    }

    /**
    * Lifecycle method that fetches the pet data from the server and updates the component's state accordingly
    * @async
    * @function
    * @returns {void}
    */
    async componentDidMount() {
        try {
            const response = await fetch('http://localhost:3000/api/petData');
            const pets = await response.json();
            this.setState({
                fetchedData: pets
            });
        } catch (error) {
            console.error(error);
        }
    }

    /**
    * Renders the DataManager component
    * @function
    * @returns {JSX.Element}
    */
    render() {
        return (
            &lt;div className="maxvp flexCenter whitebg">
                &lt;div className="Container row xLarge">
                    &lt;div className="centerText ">
                        &lt;h1>Database Manager &lt;/h1>
                    &lt;/div>
                    &lt;div className="col medPad" >
                        &lt;div className="row">
                            &lt;div className="col-4 smallPad">
                                &lt;Form.Select onChange={this.handleTypeChange}>
                                    &lt;option value="pets">Pets&lt;/option>
                                    &lt;option value="supplies">Supplies&lt;/option>
                                &lt;/Form.Select>
                            &lt;/div>
                            &lt;button onClick={this.handleOpenModal} type="submit" className="col-3 smallPad btn btn-success" style={{ marginRight: 10 }}>Add&lt;/button>
                            &lt;input onChange={this.handleSearch} type="search" className="smallPad flex" id="search" placeholder="Search">&lt;/input>

                        &lt;/div>
                    &lt;/div>
                    &lt;div>
                        &lt;DataTable
                            tableData={this.state.fetchedData}
                            search={this.state.search}
                            update={this.handleUpdate}
                            delete={this.handleDelete}
                            type={this.state.type}
                        />
                    &lt;/div>
                    {this.state.type === "pets" ? &lt;PetModal
                        handleCloseModal={this.handleCloseModal}
                        save={this.handleSave}
                        show={this.state.showModal}
                        pet={null}
                        job="save"
                    >
                    &lt;/PetModal>
                        :
                        &lt;SuppliesModal
                            handleCloseModal={this.handleCloseModal}
                            save={this.handleSave}
                            show={this.state.showModal}
                            supply={null}
                            job="save"
                        >
                        &lt;/SuppliesModal>
                    }
                &lt;/div>
            &lt;/div>
        )
    }
}

export default DataManager;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-index.html">index</a></li></ul><h3>Classes</h3><ul><li><a href="Admin.html">Admin</a></li><li><a href="App.html">App</a></li><li><a href="Cart.html">Cart</a></li><li><a href="CartItem.html">CartItem</a></li><li><a href="DataManager.html">DataManager</a></li><li><a href="DataTable.html">DataTable</a></li><li><a href="Home.html">Home</a></li><li><a href="NavigationBar.html">NavigationBar</a></li><li><a href="Pets.html">Pets</a></li><li><a href="ProductDetails.html">ProductDetails</a></li><li><a href="Supplies.html">Supplies</a></li></ul><h3>Global</h3><ul><li><a href="global.html#componentDidMount">componentDidMount</a></li><li><a href="global.html#handleCarouselClick">handleCarouselClick</a></li><li><a href="global.html#handleDisplay">handleDisplay</a></li><li><a href="global.html#handleFormSubmit-SendsaPOSTrequesttotheservertoauthenticatetheuserwiththeenteredusernameandpasswordIftheresponseisnotokay,anerroristhrownIftheresponseisokay,thehandleLoginfunctionintheparentcomponentiscalledwithavalueoftruetosettheadminstatetotrue">handleFormSubmit - Sends a POST request to the server to authenticate the user with the entered username and passwordIf the response is not okay, an error is thrownIf the response is okay, the handleLogin function in the parent component is called with a value of true to set the admin state to true</a></li><li><a href="global.html#handleLogout-LogstheuseroutoftheadmininterfacebycallingthehandleLoginfunctionintheparentcomponentwithavalueoffalse">handleLogout - Logs the user out of the admin interface by calling the handleLogin function in the parent component with a value of false</a></li><li><a href="global.html#handlePasswordChange-Updatesthepasswordinputvalueinthecomponentstatewhentheinputchanges">handlePasswordChange - Updates the password input value in the component state when the input changes</a></li><li><a href="global.html#handlePetIconClick">handlePetIconClick</a></li><li><a href="global.html#handleSelect">handleSelect</a></li><li><a href="global.html#handleSupplyIconClick">handleSupplyIconClick</a></li><li><a href="global.html#handleUsernameChange-Updatestheusernameinputvalueinthecomponentstatewhentheinputchanges">handleUsernameChange - Updates the username input value in the component state when the input changes</a></li><li><a href="global.html#render">render</a></li><li><a href="global.html#render-RendersthecomponentIftheadminstateisfalse,aloginformisdisplayedIftheadminstateistrue,alogoutbuttonandtheDataManagercomponentaredisplayed">render - Renders the componentIf the admin state is false, a login form is displayedIf the admin state is true, a logout button and the DataManager component are displayed</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Thu Mar 30 2023 18:43:22 GMT-0700 (Pacific Daylight Saving Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
